<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.ksmart.library.rental.service.RentalMapper">
  
  <!-- 도서코드와 일치하는 대여테이블 조회 -->
  <select id="rentalInfoSelect" parameterType="com.ksmart.library.dto.RentalDto"
   resultType="com.ksmart.library.dto.RentalDto">
	   select
	   		rental_code as rentalCode,
	   		book_code as bookCode,
	   		member_id as memberId,
	   		rentalstate_code as rentalStateCode,
	   		rental_start as rentalStart,
	   		rental_end as rentalEnd,
	   		rental_payment as rentalPayment,
	   		rental_prepayment as rentalPrePayment
	   	from rental
	   	where book_code = #{bookCode}
  </select>
 
 
  <!-- 도서 대여여부 확인을 위한 도서코드와 상태조회  -->
	<select id="stateSelect" parameterType="com.ksmart.library.dto.RentalDto"  resultType="int">
		select 
			state_code 
			from book 
		where book_code = #{bookCode}
	</select>
  
  <!-- 도서상대 업데이트 해주는 쿼리(대출중으로) -->
	<update id="stateUpdate" parameterType="com.ksmart.library.dto.RentalDto">
		update book
		set state_code = 2 
		where book_code= #{bookCode}
	</update>
 	
 	
 	<!-- 대여 입력(아직)  -->
 	<insert id="rentalInsert" parameterType="com.ksmart.library.dto.RentalDto">
 		insert into rental(
 			book_code, 
 			member_id, 
 			rental_prepayment
 		)
 		values (
 			#{bookCode},
 			#{memberId},
 			#{rentalPrePayment}
 		)
 	</insert>
 	
 	<!-- 멤버인지 확인 -->
 	<select id="idCheck" parameterType="com.ksmart.library.dto.RentalDto">
	 	select 
	 		member_id as memberId 
	 	from member 
	 	where member_id= #{memberId}
 	</select>
 </mapper>